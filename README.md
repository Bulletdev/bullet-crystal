#  üêì Rinha de Backend 2025 - Crystal

 <div>

                   ‚¢Ä‚£¥‚£ø‚£ø‚£ø‚£ø‚£ø‚£∂‚£∂‚£∂‚£ø‚£ø‚£∂‚£∂‚£∂‚£∂‚£∂‚£ø‚°ø‚£ø‚£æ‚£∑‚£∂‚£∂‚£æ‚£ø‚†Ä                                                                                                                          
                 ‚£†‚£ø‚£ø‚¢ø‚£ø‚£Ø‚†Ä‚¢π‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚°á‚£ø‚°á‚£ø‚£ø‚£ø‚£ø‚£ø‚°á                                                                                                     
             ‚†Ä‚£∞‚£ø‚£ø‚£∑‚°ü‚†§‚†ü‚†Å‚£º‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚¢∏‚°á‚£ø‚£ø‚£ø‚£ø‚£ø‚°á 
             ‚†Ä‚£ø‚£ø‚£ø‚£ø‚£ø‚£∑‚£∂‚£ø‚£ø‚°ü‚†Å‚£Æ‚°ª‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚¢∏‚°á‚£ø‚£ø‚£ø‚£ø‚£ø‚°á 
             ‚†ò‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚†è‚†Ä‚†Ä‚£ø‚£ø‚£π‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚°ø‚¢∏‚°á‚£ø‚£ø‚£ø‚£ø‚£ø‚°á 
             ‚†Ä‚†ô‚¢ø‚£ø‚£ø‚£ø‚°ø‚†ü‚†Å‚£ø‚£ø‚£∂‚£ø‚†ü‚¢ª‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚°á‚£º‚°á‚£ø‚£ø‚£ø‚£ø‚£ø‚†á
             ‚†Ä‚†Ä‚†à‚†ã‚†â‚†Å‚£∂‚£∂‚£∂‚£ø‚£ø‚£ø‚£ø‚¢Ä‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£á‚£ø‚¢∞‚£ø‚£ø‚£ø‚£ø‚£ø‚†Ä 
             ‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†ô‚†ø‚£ø‚£ø‚£ø‚°Ñ‚¢Ä‚£†‚£æ‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£ø‚£Ω‚£ø‚£º‚£ø‚£ø‚£ø‚£ø‚†á‚†Ä 
             ‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†à‚†â‚†í‚†ö‚†ø‚†ø‚†ø‚†ø‚†ø‚†ø‚†ø‚†ø‚†ø‚†ø‚†õ‚†ø‚†ø‚†ø‚†ø‚†ø‚†ã‚†Ä‚†Ä 
             ‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä‚†Ä 
             ‚†Ä‚†Ä‚†Ä‚£ø‚£ô‚°Ü‚†Ä‚†Ä‚°á‚†Ä‚¢∏‚†Ä‚†Ä‚¢∏‚†Ä‚†Ä ‚¢∏‚°á‚†Ä‚†Ä‚¢∏‚£è‚°â  ‚†ô‚°è‚†Å‚†Ä 
             ‚†Ä‚†Ä‚†Ä‚£ø‚£â‚°∑‚†Ä‚†Ä‚¢ß‚£Ä‚£º ‚†Ä‚¢∏‚£Ä  ‚¢∏‚£á‚°Ä ‚¢∏‚£è‚£Å‚†Ä ‚†Ä‚°á‚†Ä 

             
  </div>
  

## üìã Stack Utilizada

- **Crystal**: Linguagem de programa√ß√£o de alta performance
- **PostgreSQL**: Armazenamento de dados de pagamentos
- **Redis**: Cache para otimiza√ß√£o de health checks
- **Nginx**: Load balancer com round-robin
- **Docker**: Containeriza√ß√£o completa

##  Como Executar

### 1. Subir os Payment Processors
```bash
# Primeiro, suba os payment processors
docker-compose -f docker-compose.yml up -d
```

### 2. Subir o Backend
```bash
# Depois, suba o backend
docker-compose up -d
```

### 3. Acessar a API
A API estar√° dispon√≠vel em `http://localhost:9999`

##  Endpoints da API

 <details align="left">

### POST `/payments`

Intermedia uma solicita√ß√£o de pagamento para os Payment Processors.

**Corpo da Requisi√ß√£o:**
```json
{
  "correlationId": "4a7901b8-7d26-4d9d-aa19-4dc1c7cf60b3",
  "amount": 19.90
}
```

**Campos:**
- `correlationId`: UUID √∫nico obrigat√≥rio
- `amount`: Valor decimal obrigat√≥rio (maior que 0)

**Respostas:**
- `200 OK`: Pagamento processado com sucesso
- `400 Bad Request`: Dados de entrada inv√°lidos
- `500 Internal Server Error`: Erro no processamento

### GET `/payments-summary`

Retorna resumo dos pagamentos processados, usado para auditoria.

**Par√¢metros de Query (opcionais):**
- `from`: Timestamp ISO em UTC (ex: `2020-07-10T12:34:56.000Z`)
- `to`: Timestamp ISO em UTC (ex: `2020-07-10T12:35:56.000Z`)

**Exemplo de Uso:**
```
GET /payments-summary?from=2020-07-10T12:34:56.000Z&to=2020-07-10T12:35:56.000Z
```

**Resposta (200 OK):**
```json
{
  "default": {
    "totalRequests": 43236,
    "totalAmount": 415542345.98
  },
  "fallback": {
    "totalRequests": 423545,
    "totalAmount": 329347.34
  }
}
```

### POST `/purge-payments`  

Endpoint secreto utilizado pelo script de teste da Rinha para limpar todos os pagamentos do banco. N√£o requer corpo na requisi√ß√£o.

**Exemplo de Uso:**
```
curl -X POST http://localhost:9999/purge-payments
```

**Resposta (200 OK):**
```json
{"result": "ok"}
```
</details>

### Limites de Mem√≥ria

- API 1: 70MB
- API 2: 70MB
- PostgreSQL: 180MB
- Nginx: 20MB
- **Total: 340MB** (dentro do limite de 350MB)
